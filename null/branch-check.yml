name: Branch Name Check

on: 
#  pull_request:
#  push:  
  workflow_dispatch: 

jobs:
  check-branch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Get branch name
        id: branch
        run: |
          # Try multiple methods to get branch name
          if [ -n "$GITHUB_HEAD_REF" ]; then
            # PR event
            branch="$GITHUB_HEAD_REF"
            echo "ğŸ“ Branch from PR: $branch"
          elif [ -n "$GITHUB_REF_NAME" ]; then
            # Push event
            branch="$GITHUB_REF_NAME"
            echo "ğŸ“ Branch from push: $branch"
          else
            # Fallback to git
            branch=$(git rev-parse --abbrev-ref HEAD)
            echo "ğŸ“ Branch from git: $branch"
          fi
          
          echo "branch=$branch" >> $GITHUB_OUTPUT
          echo "Current branch: $branch"
      
      - name: Check branch naming convention
        run: |
          branch="${{ steps.branch.outputs.branch }}"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ” Branch Name Validation"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Branch: $branch"
          echo ""
          
          # Skip check for main/master
          if [[ "$branch" == "main" || "$branch" == "master" ]]; then
            echo "âœ… Main branch - skipping validation"
            exit 0
          fi
          
          # Allowed patterns
          echo "ğŸ“‹ Allowed patterns:"
          echo "  â€¢ feature/description"
          echo "  â€¢ bugfix/description"
          echo "  â€¢ hotfix/description"
          echo "  â€¢ release/version"
          echo ""
          
          # Check pattern
          if [[ "$branch" =~ ^(feature|bugfix|hotfix|release)/.+ ]]; then
            prefix=$(echo "$branch" | cut -d'/' -f1)
            description=$(echo "$branch" | cut -d'/' -f2-)
            
            echo "âœ… VALID BRANCH NAME"
            echo ""
            echo "  Type: $prefix"
            echo "  Description: $description"
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          else
            echo "âŒ INVALID BRANCH NAME"
            echo ""
            echo "Your branch: $branch"
            echo ""
            echo "âŒ Does not match required pattern"
            echo ""
            echo "Examples of valid names:"
            echo "  âœ… feature/add-login-page"
            echo "  âœ… bugfix/fix-memory-leak"
            echo "  âœ… hotfix/security-patch"
            echo "  âœ… release/v1.2.0"
            echo ""
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            exit 1
          fi
      
      - name: Additional branch checks
        if: always()
        run: |
          branch="${{ steps.branch.outputs.branch }}"
          
          echo ""
          echo "ğŸ” Additional Checks:"
          echo ""
          
          # Check for spaces
          if [[ "$branch" =~ \  ]]; then
            echo "âš ï¸  Branch contains spaces - use hyphens instead"
          else
            echo "âœ… No spaces in branch name"
          fi
          
          # Check for uppercase
          if [[ "$branch" =~ [A-Z] ]]; then
            echo "âš ï¸  Branch contains uppercase - use lowercase"
          else
            echo "âœ… All lowercase"
          fi
          
          # Check length
          length=${#branch}
          if [ $length -lt 10 ]; then
            echo "âš ï¸  Branch name is short ($length chars) - be more descriptive"
          elif [ $length -gt 50 ]; then
            echo "âš ï¸  Branch name is long ($length chars) - consider shortening"
          else
            echo "âœ… Good length ($length chars)"
          fi
        continue-on-error: true
