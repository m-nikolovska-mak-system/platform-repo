name: Simple Quality Checks

on:
#  push:
#  pull_request:
  workflow_dispatch:

jobs:
  quality-checks:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: âœ… Check README exists
        id: readme_exists
        run: |
          echo "ğŸ” Checking if README.md exists..."
          if [ -f README.md ]; then
            echo "âœ… README.md found"
            echo "status=pass" >> $GITHUB_OUTPUT
          else
            echo "âŒ README.md not found"
            echo "status=fail" >> $GITHUB_OUTPUT
            exit 1
          fi
      
      - name: ğŸ“„ Check README has content
        id: readme_content
        if: always()
        run: |
          echo "ğŸ” Checking README.md has content..."
          if [ ! -f README.md ]; then
            echo "âš ï¸  Skipping (README doesn't exist)"
            echo "status=skip" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          lines=$(wc -l < README.md)
          if [ "$lines" -gt 5 ]; then
            echo "âœ… README has $lines lines (minimum 5)"
            echo "status=pass" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸  README only has $lines lines (expected at least 5)"
            echo "status=warn" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true
      
      - name: ğŸš Check shell scripts
        id: shell_check
        if: always()
        run: |
          echo "ğŸ” Looking for shell scripts..."
          shfiles=$(find . -name "*.sh" -type f 2>/dev/null | wc -l)
          
          if [ "$shfiles" -eq 0 ]; then
            echo "â„¹ï¸  No shell scripts found - skipping"
            echo "status=skip" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          echo "Found $shfiles shell script(s)"
          has_issues=0
          
          # Check for empty scripts
          empty=$(find . -name "*.sh" -type f -empty 2>/dev/null)
          if [ -n "$empty" ]; then
            echo "âš ï¸  Empty shell scripts found:"
            echo "$empty"
            has_issues=1
          else
            echo "âœ… No empty shell scripts"
          fi
          
          # Check for shebangs
          for script in $(find . -name "*.sh" -type f 2>/dev/null); do
            if ! head -n1 "$script" | grep -q '^#!'; then
              echo "âš ï¸  Missing shebang: $script"
              has_issues=1
            fi
          done
          
          if [ "$has_issues" -eq 0 ]; then
            echo "âœ… All shell scripts are valid"
            echo "status=pass" >> $GITHUB_OUTPUT
          else
            echo "status=warn" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true
      
      - name: ğŸ“ Check Markdown files
        id: markdown_check
        if: always()
        run: |
          echo "ğŸ” Installing markdownlint..."
          npm install -g markdownlint-cli >/dev/null 2>&1
          
          echo "ğŸ” Checking Markdown files..."
          if markdownlint '**/*.md' --ignore node_modules 2>&1; then
            echo "âœ… All Markdown files are valid"
            echo "status=pass" >> $GITHUB_OUTPUT
          else
            echo ""
            echo "âš ï¸  Some Markdown issues found (see above)"
            echo "status=warn" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true
      
      - name: ğŸ“Š Summary Report
        if: always()
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“Š QUALITY CHECKS SUMMARY"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          # README exists
          status="${{ steps.readme_exists.outputs.status }}"
          if [ "$status" = "pass" ]; then
            echo "âœ… README exists: PASS"
          elif [ "$status" = "fail" ]; then
            echo "âŒ README exists: FAIL"
          fi
          
          # README content
          status="${{ steps.readme_content.outputs.status }}"
          if [ "$status" = "pass" ]; then
            echo "âœ… README content: PASS"
          elif [ "$status" = "warn" ]; then
            echo "âš ï¸  README content: WARNING"
          elif [ "$status" = "skip" ]; then
            echo "â­ï¸  README content: SKIPPED"
          fi
          
          # Shell scripts
          status="${{ steps.shell_check.outputs.status }}"
          if [ "$status" = "pass" ]; then
            echo "âœ… Shell scripts: PASS"
          elif [ "$status" = "warn" ]; then
            echo "âš ï¸  Shell scripts: WARNING"
          elif [ "$status" = "skip" ]; then
            echo "â­ï¸  Shell scripts: SKIPPED"
          fi
          
          # Markdown
          status="${{ steps.markdown_check.outputs.status }}"
          if [ "$status" = "pass" ]; then
            echo "âœ… Markdown files: PASS"
          elif [ "$status" = "warn" ]; then
            echo "âš ï¸  Markdown files: WARNING"
          fi
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # Check if README exists failed (critical)
          if [ "${{ steps.readme_exists.outputs.status }}" = "fail" ]; then
            echo ""
            echo "âŒ FAILED: Critical check failed (README must exist)"
            exit 1
          fi
          
          echo ""
          echo "âœ¨ All critical checks passed!"
          echo "âš ï¸  Warnings don't fail the workflow"
